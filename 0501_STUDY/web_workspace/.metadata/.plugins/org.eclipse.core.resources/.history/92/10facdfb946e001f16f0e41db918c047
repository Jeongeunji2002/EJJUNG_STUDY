<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>지도와 장소 검색</title>
<style>
html, body {
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
}

.map_wrap {
	position: relative;
	width: 100%;
	height: 500px;
}

.radius_border {
	border: 1px solid #919191;
	border-radius: 5px;
}

.custom_typecontrol {
	position: absolute;
	top: 10px;
	right: 10px;
	overflow: hidden;
	width: 130px;
	height: 30px;
	margin: 0;
	padding: 0;
	z-index: 1;
	font-size: 12px;
	font-family: 'Malgun Gothic', '돋움', sans-serif;
}

.custom_typecontrol span {
	display: block;
	width: 65px;
	height: 30px;
	float: left;
	text-align: center;
	line-height: 30px;
	cursor: pointer;
}

.custom_typecontrol .btn {
	background: #fff;
	background: linear-gradient(#fff, #e6e6e6);
}

.custom_typecontrol .btn:hover {
	background: #f5f5f5;
	background: linear-gradient(#f5f5f5, #e3e3e3);
}

.custom_typecontrol .btn:active {
	background: #e6e6e6;
	background: linear-gradient(#e6e6e6, #fff);
}

.custom_typecontrol .selected_btn {
	color: #fff;
	background: #425470;
	background: linear-gradient(#425470, #5b6d8a);
}

.custom_typecontrol .selected_btn:hover {
	color: #fff;
}

.custom_zoomcontrol {
	position: absolute;
	top: 50px;
	right: 10px;
	width: 36px;
	height: 80px;
	overflow: hidden;
	z-index: 1;
	background-color: #f5f5f5;
}

.custom_zoomcontrol span {
	display: block;
	width: 36px;
	height: 40px;
	text-align: center;
	cursor: pointer;
}

.custom_zoomcontrol span img {
	width: 15px;
	height: 15px;
	padding: 12px 0;
	border: none;
}

.custom_zoomcontrol span:first-child {
	border-bottom: 1px solid #bfbfbf;
}

#menu_wrap {
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0;
	width: 250px;
	margin: 10px 0 30px 10px;
	padding: 5px;
	overflow-y: auto;
	background: rgba(255, 255, 255, 0.7);
	z-index: 1;
	font-size: 12px;
	border-radius: 10px;
}

#menu_wrap .option {
	text-align: center;
}

#menu_wrap .option p {
	margin: 10px 0;
}

#menu_wrap .option button {
	margin-left: 5px;
}

#placesList li {
	list-style: none;
}

#placesList .item {
	position: relative;
	border-bottom: 1px solid #888;
	overflow: hidden;
	cursor: pointer;
	min-height: 65px;
}

#placesList .item span {
	display: block;
	margin-top: 4px;
}

#placesList .item h5, #placesList .item .info {
	text-overflow: ellipsis;
	overflow: hidden;
	white-space: nowrap;
}

#placesList .item .info {
	padding: 10px 0 10px 55px;
}

#placesList .info .gray {
	color: #8a8a8a;
}

#placesList .info .jibun {
	padding-left: 26px;
	background:
		url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/places_jibun.png)
		no-repeat;
}

#placesList .info .tel {
	color: #009900;
}

#placesList .item .markerbg {
	float: left;
	position: absolute;
	width: 36px;
	height: 37px;
	margin: 10px 0 0 10px;
	background:
		url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_number_blue.png)
		no-repeat;
}

#placesList .item .marker_1 {
	background-position: 0 -10px;
}

#placesList .item .marker_2 {
	background-position: 0 -56px;
}

#placesList .item .marker_3 {
	background-position: 0 -102px
}

#placesList .item .marker_4 {
	background-position: 0 -148px;
}

#placesList .item .marker_5 {
	background-position: 0 -194px;
}

#placesList .item .marker_6 {
	background-position: 0 -240px;
}

#placesList .item .marker_7 {
	background-position: 0 -286px;
}

#placesList .item .marker_8 {
	background-position: 0 -332px;
}

#placesList .item .marker_9 {
	background-position: 0 -378px;
}

#placesList .item .marker_10 {
	background-position: 0 -423px;
}

#placesList .item .marker_11 {
	background-position: 0 -470px;
}

#placesList .item .marker_12 {
	background-position: 0 -516px;
}

#placesList .item .marker_13 {
	background-position: 0 -562px;
}

#placesList .item .marker_14 {
	background-position: 0 -608px;
}

#placesList .item .marker_15 {
	background-position: 0 -654px;
}

#pagination {
	margin: 10px auto;
	text-align: center;
}

#pagination a {
	display: inline-block;
	margin-right: 10px;
}

#pagination .on {
	font-weight: bold;
	cursor: default;
	color: #777;
}

#optionPanel {
	display: none;
	position: absolute;
	background: white;
	border: 1px solid #ccc;
	border-radius: 5px;
	padding: 10px;
	box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
	z-index: 2;
}

#optionPanel button {
	margin: 5px;
}

#selectionBox {
    position: absolute;
    background: white;
    border: 1px solid #ccc;
    border-radius: 5px;
    padding: 10px;
    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    z-index: 2;
}

#selectionBox button {
    margin: 5px;
}
</style>
</head>
<body>
	<div class="map_wrap">
		<div id="map" style="width: 100%; height: 100%; position: relative; overflow: hidden;"></div>
		<div class="custom_typecontrol radius_border">
			<span id="btnRoadmap" class="selected_btn" onclick="setMapType('roadmap')">지도</span>
			<span id="btnSkyview" class="btn" onclick="setMapType('skyview')">스카이뷰</span>
		</div>
		<div class="custom_zoomcontrol radius_border">
			<span onclick="zoomIn()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png" alt="확대"></span>
			<span onclick="zoomOut()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png" alt="축소"></span>
		</div>
		<div id="menu_wrap" class="bg_white">
			<div class="option">
				<div>
					<form onsubmit="searchPlaces(); return false;">
						키워드 : <input type="text" value=" " id="keyword" size="15">
						<button type="submit">검색하기</button>
					</form>
				</div>
			</div>
			<hr>
			<ul id="placesList"></ul>
			<div id="pagination"></div>
		</div>
	</div>
	<div id="clickLatlng"></div>
	<div id="optionPanel">
		<p>좌표를 저장하려면 아래 버튼을 클릭하세요:</p>
		<button onclick="saveCoordinates('Option1')">시작 지점</button>
		<button onclick="saveCoordinates('Option2')">중간 지점</button>
		<button onclick="saveCoordinates('Option3')">도착 지점</button>
		<button onclick="closeOptionPanel()">취소</button>
	</div>
	<div id="selectionBox" style="display: none;">
		<p>옵션을 선택하세요:</p>
		<button onclick="handleOption('시작 지점')">시작 지점</button>
		<button onclick="handleOption('중간 지점')">중간 지점</button>
		<button onclick="handleOption('도착 지점')">도착 지점</button>
		<button onclick="closeSelectionBox()">닫기</button>
	</div>

<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_APP_KEY"></script>
<script>
var map, places;
var markers = [];
var clickedPositions = [];
var optionPanel = document.getElementById('optionPanel');
var selectionBox = document.getElementById('selectionBox');

function initMap() {
	map = new kakao.maps.Map(document.getElementById('map'), {
		center: new kakao.maps.LatLng(37.5665, 126.978), // 서울
		level: 3 // 줌 레벨
	});
	
	// 지도 클릭 이벤트
	kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
		var latlng = mouseEvent.latLng;
		var marker = new kakao.maps.Marker({
			position: latlng,
			map: map
		});
		markers.push(marker);
		clickedPositions.push(latlng);
	});
	
	// 장소 검색 객체 생성
	places = new kakao.maps.services.Places();
	
	// 옵션 패널을 닫는 클릭 이벤트
	document.addEventListener('click', function(e) {
		if (e.target.closest('#optionPanel') === null && e.target.closest('#clickLatlng') === null) {
			optionPanel.style.display = 'none';
		}
	});
	
	document.addEventListener('click', function(e) {
		if (e.target.closest('#selectionBox') === null) {
			selectionBox.style.display = 'none';
		}
	});
}

function searchPlaces() {
	var keyword = document.getElementById('keyword').value;
	if (!keyword.trim()) {
		alert('키워드를 입력해주세요!');
		return;
	}

	places.keywordSearch(keyword, placesSearchCB);
}

function placesSearchCB(data, status, pagination) {
	if (status === kakao.maps.services.Status.OK) {
		var listEl = document.getElementById('placesList');
		var menuEl = document.getElementById('menu_wrap');
		var fragment = document.createDocumentFragment();
		listEl.innerHTML = '';

		for (var i = 0; i < data.length; i++) {
			var place = data[i];
			var itemEl = document.createElement('li');
			itemEl.className = 'item';
			itemEl.innerHTML = '<span class="markerbg marker_' + (i + 1) + '"></span>' +
				'<div class="info">' +
				'<h5>' + place.place_name + '</h5>' +
				'<span class="gray">' + place.category_name + '</span>' +
				'<span class="jibun">' + place.road_address_name + '</span>' +
				'<span class="tel">' + place.phone + '</span>' +
				'</div>';

			itemEl.onclick = (function(place) {
				return function() {
					var latlng = new kakao.maps.LatLng(place.y, place.x);
					map.setCenter(latlng);
					map.setLevel(3);
					map.setZoomable(false);
				};
			})(place);

			fragment.appendChild(itemEl);
		}
		listEl.appendChild(fragment);

		var paginationEl = document.getElementById('pagination');
		paginationEl.innerHTML = '';
		if (pagination) {
			for (var i = 0; i < pagination.last; i++) {
				var el = document.createElement('a');
				el.href = '#';
				el.innerHTML = i + 1;
				if (pagination.current === i + 1) {
					el.className = 'on';
				} else {
					el.onclick = (function(page) {
						return function() {
							pagination.gotoPage(page);
						};
					})(i + 1);
				}
				paginationEl.appendChild(el);
			}
		}
	}
}

function setMapType(type) {
	if (type === 'roadmap') {
		map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
		document.getElementById('btnRoadmap').className = 'selected_btn';
		document.getElementById('btnSkyview').className = 'btn';
	} else {
		map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
		document.getElementById('btnSkyview').className = 'selected_btn';
		document.getElementById('btnRoadmap').className = 'btn';
	}
}

function zoomIn() {
	var level = map.getLevel();
	map.setLevel(level - 1);
}

function zoomOut() {
	var level = map.getLevel();
	map.setLevel(level + 1);
}

function saveCoordinates(option) {
	optionPanel.style.display = 'none';
	alert(option + ' 좌표가 저장되었습니다: ' + clickedPositions[clickedPositions.length - 1]);
}

function closeOptionPanel() {
	optionPanel.style.display = 'none';
}

function showOptionPanel() {
	optionPanel.style.display = 'block';
}

function handleOption(option) {
	selectionBox.style.display = 'none';
	alert(option + '이(가) 선택되었습니다.');
}

function closeSelectionBox() {
	selectionBox.style.display = 'none';
}

window.onload = initMap;
</script>
</body>
</html>
