<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>다음 지도 API</title>
<style>
    #map {
        width: 100%;
        height: 100vh;
    }
    #info {
        position: absolute;
        top: 10px;
        left: 10px;
        background-color: white;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
    }
</style>
</head>
<body>
    <div id="info">
        <p id="info-text">지도를 클릭하여 출발지, 경유지, 도착지를 순서대로 설정하세요.</p>
    </div>
    <div id="map"></div>

    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c97889f438939687969d7a54a445021f&libraries=services"></script>
    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = {
                center: new kakao.maps.LatLng(37.60630, 127.02405),
                level: 8,
                mapTypeId: kakao.maps.MapTypeId.ROADMAP
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);
        var markers = [];
        var polyline;
        var markerCount = 0; // Track the number of markers
        var positions = []; // To store the positions of the markers

        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
            if (markerCount < 3) {
                addMarker(mouseEvent.latLng);
                markerCount++;
                if (markerCount === 3) {
                    drawRoute(); // Draw the route after setting all markers
                }
            }
        });

        function addMarker(position) {
            var title = "";
            if (markerCount === 0) {
                title = "출발지";
            } else if (markerCount === 1) {
                title = "경유지";
            } else if (markerCount === 2) {
                title = "도착지";
            }

            var marker = new kakao.maps.Marker({
                position: position,
                map: map,
                title: title
            });
            markers.push(marker);
            positions.push(position);
            updateInfoText();
        }

        function updateInfoText() {
            var infoText = "";
            if (markerCount === 0) {
                infoText = "출발지 설정됨. 지도를 클릭하여 경유지를 설정하세요.";
            } else if (markerCount === 1) {
                infoText = "경유지 설정됨. 지도를 클릭하여 도착지를 설정하세요.";
            } else if (markerCount === 2) {
                infoText = "도착지 설정됨. 경로가 자동으로 그려집니다.";
            }
            document.getElementById('info-text').innerText = infoText;
        }

        function drawRoute() {
            if (markers.length === 3) {
                if (polyline) {
                    polyline.setMap(null);
                }
                polyline = new kakao.maps.Polyline({
                    path: positions,
                    strokeWeight: 3,
                    strokeColor: '#FF0000',
                    strokeOpacity: 0.7,
                    strokeStyle: 'solid'
                });
                polyline.setMap(map);
            }
        }
    </script>
</body>
</html>
