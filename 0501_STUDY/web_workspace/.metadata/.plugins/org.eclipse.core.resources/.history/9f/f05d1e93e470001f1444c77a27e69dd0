<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>다음 지도 API</title>
<style>
    #map {
        width: 80%;
        height: 100vh;
        float: right;
    }
    #search {
        width: 20%;
        height: 100vh;
        float: left;
        padding: 10px;
        box-sizing: border-box;
    }
    .search-box {
        margin-bottom: 10px;
    }
    .search-box input {
        width: calc(100% - 22px);
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    .search-box button {
        width: 100%;
        padding: 10px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    .search-box button:hover {
        background-color: #0056b3;
    }
</style>
</head>
<body>
    <div id="search">
        <div class="search-box">
            <input id="start" type="text" placeholder="출발지">
            <button onclick="searchPlace('start')">출발지 검색</button>
        </div>
        <div class="search-box">
            <input id="via" type="text" placeholder="경유지">
            <button onclick="searchPlace('via')">경유지 검색</button>
        </div>
        <div class="search-box">
            <input id="end" type="text" placeholder="도착지">
            <button onclick="searchPlace('end')">도착지 검색</button>
        </div>
    </div>
    <div id="map"></div>

    <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=c97889f438939687969d7a54a445021f&libraries=services"></script>
    <script>
        var mapContainer = document.getElementById('map'), 
            mapOption = {
                center: new kakao.maps.LatLng(37.60630, 127.02405),
                level: 8,
                mapTypeId: kakao.maps.MapTypeId.ROADMAP
            };
        var map = new kakao.maps.Map(mapContainer, mapOption);
        var markers = [];
        var polyline;
        var clickedMarker;

        kakao.maps.event.addListener(map, 'click', function(mouseEvent) {        
            addMarker(mouseEvent.latLng);             
        });

        function addMarker(position) {
            var marker = new kakao.maps.Marker({
                position: position,
                draggable: true
            });
            marker.setMap(map);
            markers.push(marker);
            updatePolyline();
            kakao.maps.event.addListener(marker, 'dragend', function() {
                updatePolyline();
            });
            // Add a click event listener to the marker
            kakao.maps.event.addListener(marker, 'click', function() {
                removeMarker(marker);
            });
        }

        function removeMarker(marker) {
            // Remove the marker from the map and the markers array
            marker.setMap(null);
            var index = markers.indexOf(marker);
            if (index > -1) {
                markers.splice(index, 1);
            }
            // Update the polyline after removing the marker
            updatePolyline();
        }

        function updatePolyline() {
            var path = [];
            for (var i = 0; i < markers.length; i++) {
                path.push(markers[i].getPosition());
            }
            if (polyline) {
                polyline.setMap(null);
            }
            polyline = new kakao.maps.Polyline({
                path: path,
                strokeWeight: 3,
                strokeColor: '#FF0000',
                strokeOpacity: 0.7,
                strokeStyle: 'solid'
            });
            polyline.setMap(map);
        }

        var ps = new kakao.maps.services.Places(); 

        function searchPlace(type) {
            var keyword = document.getElementById(type).value;
            ps.keywordSearch(keyword, function(data, status, pagination) {
                if (status === kakao.maps.services.Status.OK) {
                    var place = data[0];
                    var position = new kakao.maps.LatLng(place.y, place.x);
                    addMarker(position);
                } else {
                    alert('검색 결과가 없습니다.');
                }
            });
        }
    </script>
</body>
</html>
